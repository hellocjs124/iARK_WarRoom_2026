<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iARK RMT ä½œæˆ˜æŒ‡æŒ¥å®¤</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans SC"', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .pulse-border { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(225, 29, 72, 0); }
            100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col overflow-hidden">

<div id="app" class="flex flex-col h-screen">

    <!-- 1. é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="glass-panel sticky top-0 z-50 px-6 py-3 flex items-center justify-between shadow-xl shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/30">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight text-white leading-tight">iARK RMT <span class="text-indigo-400">ä½œæˆ˜æŒ‡æŒ¥å®¤</span></h1>
                <p class="text-[10px] text-slate-400 font-medium tracking-widest uppercase">Project War Room</p>
            </div>
        </div>

        <!-- è§†å›¾åˆ‡æ¢ Tabs -->
        <nav class="flex bg-slate-900/80 p-1 rounded-lg border border-slate-700/50">
            <button v-for="tab in tabs" :key="tab.id"
                @click="currentTab = tab.id" 
                :class="['px-5 py-2 rounded-md text-sm font-semibold transition-all flex items-center gap-2', currentTab === tab.id ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-400 hover:text-white hover:bg-slate-800']">
                <span>{{ tab.icon }}</span>
                {{ tab.name }}
            </button>
        </nav>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="flex gap-2">
            <input type="file" ref="fileInput" @change="importJSON" class="hidden" accept=".json">
            <button @click="$refs.fileInput.click()" class="flex items-center gap-2 px-3 py-2 text-xs font-bold text-slate-300 hover:text-white hover:bg-slate-800 rounded border border-transparent hover:border-slate-600 transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                å¯¼å…¥æ•°æ®
            </button>
            <button @click="exportJSON" class="flex items-center gap-2 px-3 py-2 text-xs font-bold text-slate-300 hover:text-white hover:bg-slate-800 rounded border border-transparent hover:border-slate-600 transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                å¯¼å‡ºå¤‡ä»½
            </button>
        </div>
    </header>

    <!-- 2. ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 overflow-y-auto p-6 scroll-smooth bg-gradient-to-b from-slate-900 to-slate-950">
        
        <!-- ======================= è§†å›¾ 1: é‡ç‚¹é¡¹ç›®è·Ÿè¸ª ======================= -->
        <div v-if="currentTab === 'tracker'" class="space-y-6 animate-fade-in">
            <div class="flex justify-between items-end mb-2">
                <h2 class="text-lg font-bold text-white border-l-4 border-indigo-500 pl-3">é‡ç‚¹é¡¹ç›®çŠ¶æ€çœ‹æ¿</h2>
                <button @click="openProjectModal(true)" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded text-sm font-bold shadow-lg flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> æ–°å¢é¡¹ç›®
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">
                <div v-for="(project, index) in projects" :key="index" 
                     class="group bg-slate-800/40 rounded-xl border transition-all duration-200 hover:bg-slate-800/80 hover:shadow-xl hover:-translate-y-1 backdrop-blur-sm"
                     :class="[
                        getStatusBorderColor(project.status),
                        hasCriticalBlocker(project) ? 'border-l-[6px] border-l-rose-500' : 'border-l-[6px]'
                     ]">
                    
                    <!-- Header -->
                    <div class="p-4 border-b border-slate-700/40 flex justify-between items-start">
                        <div class="flex-1 min-w-0 pr-2">
                            <div class="flex items-center gap-2 mb-1.5">
                                <span v-if="project.priority === 'P0'" class="px-1.5 py-0.5 rounded text-[10px] font-black bg-rose-500/20 text-rose-400 border border-rose-500/30">P0</span>
                                <span v-else class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-blue-500/20 text-blue-400 border border-blue-500/30">P1</span>
                                <h3 class="text-base font-bold text-white truncate cursor-pointer hover:text-indigo-300" @click="editProject(index)">{{ project.name }}</h3>
                            </div>
                            <div class="text-xs text-slate-400 flex items-center gap-1 truncate" title="Owner">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                {{ project.owner }}
                            </div>
                        </div>
                        
                        <!-- Status Traffic Light -->
                        <button @click.stop="toggleProjectStatus(project)" class="flex flex-col items-center gap-1 group-hover:scale-105 transition-transform">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center shadow-inner border border-slate-900/50" :class="getStatusDotColor(project.status)">
                                <div class="w-3 h-3 bg-white rounded-full opacity-30 animate-pulse" v-if="project.status === 'risk' || project.status === 'blocked'"></div>
                            </div>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="p-4 space-y-3">
                        <!-- Progress -->
                        <div>
                            <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">
                                <span>Progress</span>
                                <span :class="project.progress === 100 ? 'text-emerald-400' : 'text-slate-300'">{{ project.progress }}%</span>
                            </div>
                            <div class="w-full bg-slate-700/50 rounded-full h-1.5">
                                <div class="h-1.5 rounded-full transition-all duration-700" :class="getProgressColor(project.status)" :style="{ width: project.progress + '%' }"></div>
                            </div>
                        </div>

                        <!-- Update -->
                        <div class="bg-slate-900/30 p-2.5 rounded border border-slate-700/30 min-h-[60px]">
                            <p class="text-xs text-slate-300 leading-relaxed whitespace-pre-wrap">{{ project.weeklyUpdate || 'æš‚æ— æ›´æ–°' }}</p>
                        </div>

                        <!-- Risks -->
                        <div v-if="hasCriticalBlocker(project)" class="flex items-start gap-2 text-rose-300 bg-rose-950/20 p-2 rounded border border-rose-500/20 animate-pulse">
                            <svg class="w-4 h-4 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                            <p class="text-xs font-medium">{{ project.risks }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= è§†å›¾ 2: Roadmap ======================= -->
        <div v-if="currentTab === 'roadmap'" class="h-full flex flex-col animate-fade-in pb-10">
            <h2 class="text-lg font-bold text-white mb-4 pl-3 border-l-4 border-indigo-500">2026 å¹´åº¦æˆ˜ç•¥è§„åˆ’ (Editable)</h2>
            
            <div class="flex-1 grid grid-cols-4 gap-4 min-w-[1000px] overflow-x-auto">
                <!-- Quarters -->
                <div v-for="quarter in ['Q1', 'Q2', 'Q3', 'Q4']" :key="quarter" class="flex flex-col gap-3">
                    <!-- Column Header -->
                    <div class="bg-slate-800/80 p-3 rounded-t-lg border-b-2 border-indigo-500 text-center shadow-lg">
                        <span class="text-lg font-black text-white block">{{ quarter }}</span>
                    </div>

                    <!-- Capability Track -->
                    <div class="glass-card flex-1 rounded-lg p-3 flex flex-col gap-2 relative group">
                        <div class="text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-1 flex justify-between items-center">
                            ğŸ›¡ï¸ èƒ½åŠ›è¡¥é½ (Biz)
                            <button @click="openRoadmapModal(quarter, 'capability')" class="text-slate-500 hover:text-white opacity-0 group-hover:opacity-100 transition">+</button>
                        </div>
                        <div v-for="(item, idx) in roadmap[quarter].capability" :key="idx" 
                             @click="editRoadmapItem(quarter, 'capability', idx)"
                             class="bg-blue-900/20 border border-blue-500/20 p-2 rounded text-xs text-blue-100 cursor-pointer hover:bg-blue-900/40 hover:border-blue-400 transition">
                            {{ item }}
                        </div>
                    </div>

                    <!-- Experience Track -->
                    <div class="glass-card flex-1 rounded-lg p-3 flex flex-col gap-2 relative group">
                        <div class="text-[10px] font-bold text-emerald-400 uppercase tracking-widest mb-1 flex justify-between items-center">
                            âš¡ ä½“éªŒä¼˜åŒ– (UX)
                            <button @click="openRoadmapModal(quarter, 'experience')" class="text-slate-500 hover:text-white opacity-0 group-hover:opacity-100 transition">+</button>
                        </div>
                        <div v-for="(item, idx) in roadmap[quarter].experience" :key="idx" 
                             @click="editRoadmapItem(quarter, 'experience', idx)"
                             class="bg-emerald-900/20 border border-emerald-500/20 p-2 rounded text-xs text-emerald-100 cursor-pointer hover:bg-emerald-900/40 hover:border-emerald-400 transition">
                            {{ item }}
                        </div>
                    </div>

                    <!-- AI Track -->
                    <div class="glass-card flex-1 rounded-lg p-3 flex flex-col gap-2 relative group">
                        <div class="text-[10px] font-bold text-purple-400 uppercase tracking-widest mb-1 flex justify-between items-center">
                            ğŸ§  AI Native
                            <button @click="openRoadmapModal(quarter, 'ai')" class="text-slate-500 hover:text-white opacity-0 group-hover:opacity-100 transition">+</button>
                        </div>
                        <div v-for="(item, idx) in roadmap[quarter].ai" :key="idx" 
                             @click="editRoadmapItem(quarter, 'ai', idx)"
                             class="bg-purple-900/20 border border-purple-500/20 p-2 rounded text-xs text-purple-100 cursor-pointer hover:bg-purple-900/40 hover:border-purple-400 transition">
                            {{ item }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= è§†å›¾ 3: Gap Matrix ======================= -->
        <div v-if="currentTab === 'gap'" class="max-w-6xl mx-auto animate-fade-in pb-10">
            <h2 class="text-lg font-bold text-white mb-6 pl-3 border-l-4 border-indigo-500">ç«å“å·®è·åˆ†æçŸ©é˜µ (vs Longbridge/Rockflow)</h2>
            
            <div class="bg-slate-800/50 rounded-xl overflow-hidden border border-slate-700 shadow-2xl backdrop-blur-sm">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-900/90 text-slate-400 uppercase text-xs font-bold tracking-wider border-b border-slate-700">
                            <th class="p-4 w-1/4">è¯„ä¼°ç»´åº¦ (ç‚¹å‡»ç¼–è¾‘)</th>
                            <th class="p-4 text-center w-[14%]">Q1 ç°çŠ¶</th>
                            <th class="p-4 text-center w-[14%]">Q2 ç›®æ ‡</th>
                            <th class="p-4 text-center w-[14%]">Q3 ç›®æ ‡</th>
                            <th class="p-4 text-center w-[14%]">Q4 æ„¿æ™¯</th>
                            <th class="p-4 text-center w-[14%] bg-slate-800/80 text-indigo-300">ç«å“æ ‡æ†</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm divide-y divide-slate-700/50">
                        <tr v-for="(row, idx) in gapMatrix" :key="idx" class="group hover:bg-slate-800/30 transition">
                            <!-- Header -->
                            <td class="p-4 font-bold text-white cursor-pointer hover:text-indigo-400" @click="editGapRowName(idx)">
                                <div class="flex items-center gap-2">
                                    {{ row.category }}
                                    <svg class="w-3 h-3 text-slate-600 opacity-0 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                                </div>
                            </td>
                            
                            <!-- Quarters -->
                            <td v-for="q in ['q1', 'q2', 'q3', 'q4']" :key="q" 
                                class="p-4 text-center cursor-pointer relative"
                                @click="toggleGapStatus(row, q)">
                                <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border transition-all select-none"
                                     :class="getGapStatusStyle(row[q])">
                                    <span class="w-2 h-2 rounded-full" :class="getGapDotColor(row[q])"></span>
                                    <span class="font-bold text-xs">{{ getGapStatusLabel(row[q]) }}</span>
                                </div>
                                <div class="text-[10px] text-slate-600 mt-1 opacity-0 group-hover:opacity-100 transition">ç‚¹å‡»åˆ‡æ¢</div>
                            </td>

                            <!-- Benchmark -->
                            <td class="p-4 text-center bg-slate-800/20 cursor-pointer" @click="toggleGapStatus(row, 'benchmark')">
                                <div class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border transition-all select-none opacity-80"
                                     :class="getGapStatusStyle(row.benchmark)">
                                    <span class="w-2 h-2 rounded-full" :class="getGapDotColor(row.benchmark)"></span>
                                    <span class="font-bold text-xs">{{ getGapStatusLabel(row.benchmark) }}</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 text-xs text-slate-500 flex gap-4 justify-end">
                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-rose-500 rounded-full"></span> è½å</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-amber-500 rounded-full"></span> è¿½èµ¶ä¸­</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-emerald-500 rounded-full"></span> é½å¹³/é¢†å…ˆ</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-purple-500 rounded-full"></span> è¡Œä¸šå£å’</span>
            </div>
        </div>

    </main>

    <!-- ======================= MODALS ======================= -->

    <!-- 1. Project Modal -->
    <div v-if="modals.project.show" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-slate-900 rounded-xl shadow-2xl border border-slate-700 w-full max-w-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 border-b border-slate-800 pb-3">
                {{ modals.project.isNew ? 'æ–°å¢é¡¹ç›®' : 'ç¼–è¾‘é¡¹ç›®' }}
            </h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-2">
                    <label class="text-xs text-slate-400">é¡¹ç›®åç§°</label>
                    <input v-model="modals.project.data.name" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500">
                </div>
                <div>
                    <label class="text-xs text-slate-400">Owner (Biz/Tech)</label>
                    <input v-model="modals.project.data.owner" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500">
                </div>
                <div>
                    <label class="text-xs text-slate-400">çŠ¶æ€ (RAG)</label>
                    <select v-model="modals.project.data.status" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500">
                        <option value="normal">ğŸŸ¢ æ­£å¸¸ (On Track)</option>
                        <option value="risk">ğŸŸ¡ æœ‰é£é™© (At Risk)</option>
                        <option value="blocked">ğŸ”´ ä¸¥é‡é˜»å¡ (Blocked)</option>
                        <option value="completed">ğŸ”µ å·²å®Œæˆ (Completed)</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-slate-400">ä¼˜å…ˆçº§</label>
                    <select v-model="modals.project.data.priority" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500">
                        <option value="P0">P0 - æé«˜</option>
                        <option value="P1">P1 - é«˜</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-slate-400">è¿›åº¦ (%)</label>
                    <input type="number" v-model.number="modals.project.data.progress" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500">
                </div>
                <div class="col-span-2">
                    <label class="text-xs text-slate-400">æœ¬å‘¨æ›´æ–° (Update)</label>
                    <textarea v-model="modals.project.data.weeklyUpdate" rows="3" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:outline-none focus:border-indigo-500"></textarea>
                </div>
                <div class="col-span-2">
                    <label class="text-xs text-slate-400">é£é™©ä¸å¡ç‚¹ (Risks)</label>
                    <textarea v-model="modals.project.data.risks" rows="2" class="w-full bg-slate-800 border border-rose-900/50 rounded p-2 text-white focus:outline-none focus:border-rose-500" placeholder="è‹¥éç»¿ç¯çŠ¶æ€ï¼Œè¯·å¿…å¡«"></textarea>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button @click="modals.project.show = false" class="px-4 py-2 text-slate-400 hover:text-white">å–æ¶ˆ</button>
                <button @click="saveProject" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded font-bold">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- 2. Roadmap Item Modal -->
    <div v-if="modals.roadmap.show" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-slate-900 rounded-xl shadow-2xl border border-slate-700 w-full max-w-lg p-6">
            <h3 class="text-xl font-bold text-white mb-4">
                {{ modals.roadmap.isNew ? 'æ·»åŠ è§„åˆ’é¡¹' : 'ç¼–è¾‘è§„åˆ’é¡¹' }} 
                <span class="text-sm font-normal text-slate-400 ml-2">({{ modals.roadmap.quarter }} - {{ getRoadmapLabel(modals.roadmap.category) }})</span>
            </h3>
            <div class="mb-4">
                <label class="text-xs text-slate-400 block mb-1">å†…å®¹æè¿° ([æ ‡é¢˜] è¯¦æƒ…)</label>
                <textarea v-model="modals.roadmap.text" rows="4" class="w-full bg-slate-800 border border-slate-700 rounded p-3 text-white focus:outline-none focus:border-indigo-500"></textarea>
            </div>
            <div class="flex justify-between mt-6">
                <button v-if="!modals.roadmap.isNew" @click="deleteRoadmapItem" class="text-rose-500 hover:text-rose-400 text-sm font-bold">åˆ é™¤æ­¤é¡¹</button>
                <div v-else></div>
                <div class="flex gap-3">
                    <button @click="modals.roadmap.show = false" class="px-4 py-2 text-slate-400 hover:text-white">å–æ¶ˆ</button>
                    <button @click="saveRoadmapItem" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded font-bold">ç¡®è®¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Gap Row Name Modal -->
    <div v-if="modals.gap.show" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-slate-900 rounded-xl shadow-2xl border border-slate-700 w-full max-w-md p-6">
            <h3 class="text-xl font-bold text-white mb-4">ç¼–è¾‘ç»´åº¦åç§°</h3>
            <input v-model="modals.gap.text" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white mb-4 focus:outline-none focus:border-indigo-500">
            <div class="flex justify-end gap-3">
                <button @click="modals.gap.show = false" class="px-4 py-2 text-slate-400 hover:text-white">å–æ¶ˆ</button>
                <button @click="saveGapRowName" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded font-bold">ä¿å­˜</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentTab: 'tracker',
                tabs: [
                    { id: 'tracker', name: 'é‡ç‚¹é¡¹ç›®è·Ÿè¸ª', icon: 'ğŸš€' },
                    { id: 'roadmap', name: '2026 Roadmap', icon: 'ğŸ—ºï¸' },
                    { id: 'gap', name: 'å·®è·åˆ†æçŸ©é˜µ', icon: 'ğŸ“Š' }
                ],
                // ================= DATA MODELS =================
                projects: [
                    { name: "æ–°åŠ å¡è¯åˆ¸ (SG Launch)", priority: "P0", owner: "Ray/Rosita/èƒ¡ä¸­å…´", status: "risk", progress: 85, weeklyUpdate: "æŠ€æœ¯ç ”å‘åŸºæœ¬å®Œæˆï¼Œè¿›å…¥UATã€‚", risks: "ROäººå‘˜å…¥èŒæ»åã€‚" },
                    { name: "é¦™æ¸¯èèµ„ä¸šåŠ¡ (Margin)", priority: "P0", owner: "Zoe/åˆ˜å˜‰ä¿Š/ç‹çº²", status: "normal", progress: 40, weeklyUpdate: "æ ¸å¿ƒåˆ©æ¯æ¨¡å—å¼€å‘ä¸­ã€‚", risks: "" },
                    { name: "Appä½“éªŒä¼˜åŒ–", priority: "P1", owner: "Gary/é«˜èµµè¾‰", status: "normal", progress: 20, weeklyUpdate: "å®Œæˆç«å“è°ƒç ”ï¼Œç¡®å®šä¸€é”®å¤è´­ä¸ºé€Ÿèµ¢é¡¹ã€‚", risks: "" },
                    { name: "AIé¡¹ç›® (Native)", priority: "P1", owner: "Gary/æ¨æ—¶æ©", status: "risk", progress: 15, weeklyUpdate: "App 2.0è§†è§‰è§„èŒƒè®¾è®¡ä¸­ã€‚", risks: "Nexusä¸Appæ”¹ç‰ˆèµ„æºéœ€å¯¹é½ã€‚" },
                    { name: "æµ·å¤–è´­ä¹°åŠ›å»ºè®¾", priority: "P1", owner: "Rosita/ç‹çº²", status: "normal", progress: 30, weeklyUpdate: "è´¦æˆ·æ‰“é€šæ–¹æ¡ˆè¯„å®¡å®Œæˆã€‚", risks: "" },
                    { name: "è¯åˆ¸å®šæŠ• (SIP)", priority: "P1", owner: "Gary/æ¬§è¹", status: "normal", progress: 10, weeklyUpdate: "PRDè¯„å®¡é˜¶æ®µã€‚", risks: "" },
                    { name: "å€ºåˆ¸é¡¹ç›®", priority: "P2", owner: "Diana/Nancy", status: "normal", progress: 50, weeklyUpdate: "è¡Œæƒ…æºå¯¹æ¥æµ‹è¯•ä¸­ã€‚", risks: "" },
                    { name: "ä»Šæ—¥è¾¾ (Money Plus)", priority: "P1", owner: "æ¬§è¹/Nancy", status: "completed", progress: 100, weeklyUpdate: "å·²ä¸Šçº¿ç¨³å®šè¿è¡Œã€‚", risks: "" }
                ],
                roadmap: {
                    Q1: {
                        capability: ["[æ–°åŠ å¡è¯åˆ¸] å¼€æˆ·/å…¥é‡‘/äº¤æ˜“å…¨é“¾è·¯", "[é¦™æ¸¯èèµ„] æ¸¯ç¾è‚¡èèµ„ä¸Šçº¿"],
                        experience: ["[å¼€æˆ·ç®€åŒ–] SG/HKç¼©å‡å­—æ®µ", "[ä¸€é”®å¤è´­å…¥é‡‘] é¦–é¡µå¿«æ·å…¥å£"],
                        ai: ["[è§„åˆ’] è¯ºå¨…AIäº§å“è§„åˆ’", "[äº¤äº’] äº¤äº’å±‚é¢æ”¹é€ ", "[æ¦‚å¿µ] App 2.0 VISåŠDemo", "[è¯•è¿è¡Œ] å•åœºæ™¯ä¸Šçº¿", "[è®¡åˆ’] ç¡®å®š3ä¸ªåœºæ™¯"]
                    },
                    Q2: {
                        capability: ["[IPOèèµ„] æ–°è‚¡æ‰“æ–°", "[è¯åˆ¸å®šæŠ•] æ¸¯ç¾è‚¡/ETFå®šæŠ•", "[å…¨å§”ETF] ç§å‹Ÿå…¨å§”äº¤æ˜“", "[å€ºåˆ¸] äº§å“ä¸Šçº¿", "[å…¨è´­ä¹°åŠ›Ph1] ç°é‡‘+ä¹°æ¸¯è‚¡"],
                        experience: ["[èµ„äº§è§†å›¾] 7å¤§åˆ†ç±»/æ¸…æ™°åŒ–", "[è´§æ¶æ¸…æ™°åŒ–] å¯¼èˆªé‡æ„", "[è´¦æˆ·çº¿ä¸ŠåŒ–] PI/ç¨åŠ¡/è§£å†»æ–­ç‚¹æ¶ˆé™¤", "[é—­ç¯ä¼˜åŒ–] å…¬å‹Ÿ/å…¨å§”æµç¨‹"],
                        ai: ["[è¯¦æƒ…é¡µAIåŒ–] å¼‚åŠ¨/è´¢æŠ¥", "[èµ„äº§è¯Šæ–­] æŒä»“åˆ†æå»ºè®®", "[èµ„è®¯æ´å¯Ÿ] èˆ†æƒ…åˆ†æ", "[ä¸€å¥è¯ç»„åˆ] æ¨¡æ‹Ÿä¸‹å•", "[äººæ€§åŒ–] æ€§æ ¼/æ˜µç§°"]
                    },
                    Q3: {
                        capability: ["[ç¾è‚¡æœŸæƒ] è¡Œæƒ…ä¸äº¤æ˜“", "[Algoäº¤æ˜“] å‡ä»·ç®—æ³•å•", "[å…¨è´­ä¹°åŠ›Ph2] è¯åˆ¸æ‰“é€šè´¢å¯Œ"],
                        experience: ["[èµ„è®¯æ”¹ç‰ˆ] è§‚ç‚¹å³è´§æ¶", "[å¯è¡¡é‡] PV/UVçœ‹æ¿", "[å®‰å“ä¸Šæ¶] HK/SGæ¸ é“"],
                        ai: ["[åä½œå¼•æ“] Nexusè”åŠ¨App", "[å­˜ç»­è‡ªåŠ¨åŒ–] æŠ¥å‘Šæ¨é€", "[AIç†è´¢å¸ˆ] å¤æ‚å’¨è¯¢"]
                    },
                    Q4: {
                        capability: ["[å¤šå¸‚åœº] æ—¥/å°è‚¡", "[æ•°å­—è´§å¸] Hashkey", "[å…¨è´­ä¹°åŠ›Ph3] å®Œå…¨æ‰“é€š"],
                        experience: ["[æŠ•èµ„é—­ç¯] ç§å‹Ÿ/è¯åˆ¸ä¼˜åŒ–", "[One ID] å…¨çƒè´¦æˆ·è½åœ°", "[èµ„äº§é¡µ] æ”¶ç›Šèµ°åŠ¿/å½’å› "],
                        ai: ["[äº¤äº’å‡è´Ÿ] ä¸€å¥è¯æ¢æ±‡/ä¿®èµ„æ–™", "[è¯­éŸ³äº¤æ˜“] è¯­ä¹‰æŒ‡ä»¤ä¸‹å•", "[ä»»åŠ¡DIY] è‡ªå®šä¹‰ç›¯ç›˜"]
                    }
                },
                gapMatrix: [
                    { category: "åŸºç¡€äº¤æ˜“ä½“éªŒ", q1: "red", q2: "yellow", q3: "green", q4: "green", benchmark: "green" },
                    { category: "è¡ç”Ÿå“ä¸é«˜é˜¶èƒ½åŠ›", q1: "red", q2: "yellow", q3: "green", q4: "green", benchmark: "green" },
                    { category: "AI äº¤äº’ä½“éªŒ", q1: "yellow", q2: "green", q3: "green", q4: "star", benchmark: "yellow" },
                    { category: "è´¦æˆ·ä¸èµ„é‡‘æ•ˆç‡", q1: "yellow", q2: "green", q3: "green", q4: "green", benchmark: "green" }
                ],
                // ================= MODAL STATES =================
                modals: {
                    project: { show: false, isNew: false, index: -1, data: {} },
                    roadmap: { show: false, isNew: false, quarter: '', category: '', index: -1, text: '' },
                    gap: { show: false, index: -1, text: '' }
                }
            }
        },
        methods: {
            // --- Helper: Project Tracker ---
            getStatusDotColor(status) {
                const map = { normal: 'bg-emerald-500', risk: 'bg-amber-500', blocked: 'bg-rose-500', completed: 'bg-blue-500' };
                return map[status];
            },
            getStatusBorderColor(status) {
                const map = { normal: 'border-l-emerald-500', risk: 'border-l-amber-500', blocked: 'border-l-rose-500', completed: 'border-l-blue-500' };
                return map[status];
            },
            getProgressColor(status) {
                const map = { normal: 'bg-emerald-500', risk: 'bg-amber-500', blocked: 'bg-rose-500', completed: 'bg-blue-500' };
                return map[status];
            },
            hasCriticalBlocker(p) {
                return (p.status === 'risk' || p.status === 'blocked') && p.risks && p.risks.length > 0;
            },
            toggleProjectStatus(p) {
                const states = ['normal', 'risk', 'blocked', 'completed'];
                const next = states[(states.indexOf(p.status) + 1) % 4];
                p.status = next;
            },
            openProjectModal(isNew, idx = -1) {
                this.modals.project.isNew = isNew;
                this.modals.project.index = idx;
                this.modals.project.data = isNew 
                    ? { name: "", priority: "P1", status: "normal", progress: 0, weeklyUpdate: "", risks: "", owner: "" }
                    : { ...this.projects[idx] };
                this.modals.project.show = true;
            },
            editProject(idx) { this.openProjectModal(false, idx); },
            saveProject() {
                if (this.modals.project.isNew) this.projects.unshift(this.modals.project.data);
                else this.projects[this.modals.project.index] = this.modals.project.data;
                this.modals.project.show = false;
            },

            // --- Helper: Roadmap ---
            getRoadmapLabel(cat) {
                const map = { ai: 'AI Native', experience: 'ä½“éªŒä¼˜åŒ–', capability: 'èƒ½åŠ›è¡¥é½' };
                return map[cat];
            },
            openRoadmapModal(q, cat, idx = -1) {
                const isNew = idx === -1;
                this.modals.roadmap = {
                    show: true, isNew, quarter: q, category: cat, index: idx,
                    text: isNew ? '' : this.roadmap[q][cat][idx]
                };
            },
            editRoadmapItem(q, cat, idx) { this.openRoadmapModal(q, cat, idx); },
            saveRoadmapItem() {
                const { quarter, category, index, isNew, text } = this.modals.roadmap;
                if (!text.trim()) return;
                if (isNew) this.roadmap[quarter][category].push(text);
                else this.roadmap[quarter][category][index] = text;
                this.modals.roadmap.show = false;
            },
            deleteRoadmapItem() {
                const { quarter, category, index } = this.modals.roadmap;
                this.roadmap[quarter][category].splice(index, 1);
                this.modals.roadmap.show = false;
            },

            // --- Helper: Gap Matrix ---
            getGapStatusStyle(s) {
                const map = {
                    red: 'bg-rose-900/30 text-rose-300 border-rose-500/30',
                    yellow: 'bg-amber-900/30 text-amber-300 border-amber-500/30',
                    green: 'bg-emerald-900/30 text-emerald-300 border-emerald-500/30',
                    star: 'bg-purple-900/30 text-purple-300 border-purple-500/30 shadow-[0_0_10px_rgba(168,85,247,0.3)]'
                };
                return map[s];
            },
            getGapDotColor(s) {
                return { red: 'bg-rose-500', yellow: 'bg-amber-500', green: 'bg-emerald-500', star: 'bg-purple-400' }[s];
            },
            getGapStatusLabel(s) {
                return { red: 'è½å', yellow: 'è¿½èµ¶', green: 'é½å¹³', star: 'è¶…è¶Š' }[s];
            },
            toggleGapStatus(row, field) {
                const states = ['red', 'yellow', 'green', 'star'];
                const current = row[field];
                const next = states[(states.indexOf(current) + 1) % 4];
                row[field] = next;
            },
            editGapRowName(idx) {
                this.modals.gap.index = idx;
                this.modals.gap.text = this.gapMatrix[idx].category;
                this.modals.gap.show = true;
            },
            saveGapRowName() {
                this.gapMatrix[this.modals.gap.index].category = this.modals.gap.text;
                this.modals.gap.show = false;
            },

            // --- Persistence ---
            exportJSON() {
                const data = {
                    projects: this.projects,
                    roadmap: this.roadmap,
                    gapMatrix: this.gapMatrix
                };
                const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
                const anchor = document.createElement('a');
                anchor.setAttribute("href", str);
                anchor.setAttribute("download", `WarRoom_Backup_${new Date().toISOString().slice(0,10)}.json`);
                document.body.appendChild(anchor);
                anchor.click();
                anchor.remove();
            },
            importJSON(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const d = JSON.parse(ev.target.result);
                        if(d.projects && d.roadmap && d.gapMatrix) {
                            this.projects = d.projects;
                            this.roadmap = d.roadmap;
                            this.gapMatrix = d.gapMatrix;
                            alert("æ•°æ®æ¢å¤æˆåŠŸï¼");
                        } else {
                            alert("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘æ ¸å¿ƒæ•°æ®å­—æ®µã€‚");
                        }
                    } catch(err) { alert("JSON è§£æå¤±è´¥"); }
                };
                reader.readAsText(file);
            }
        }
    }).mount('#app');
</script>
</body>
</html>